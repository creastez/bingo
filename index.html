<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NeuroBingo — Versão Completa</title>

<!-- Fonts (CDN) - OK para copy/paste -->
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  :root{
    --bg: #0e0e10;
    --bg2: #111213;
    --text: #e6e6e6;
    --accent: #8b8365;
    --accent2: #cabf9f;
    --shadow: rgba(0,0,0,0.6);
    --cell: #3a3a3c;
    --cell-text: #e5e5e5;
    --cell-border: #2a2a2c;
    --marked: #141415;
    --marked-text: #c9c9c9;
    --marked-border: #5c5440;
    --radius: 8px;
    --gap: 8px;
    --cell-size: 84px;
  }

  html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
  .app{max-width:1100px;margin:18px auto;padding:18px;border-radius:12px;}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  h1{font-family: Cinzel, serif;margin:0;color:var(--accent);font-size:26px;text-shadow:0 2px 10px rgba(0,0,0,.6)}
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  select, textarea, input[type="text"]{background:var(--bg2);border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px;color:var(--text);font-size:14px}
  button{background:var(--accent);border:none;padding:8px 12px;border-radius:8px;color:#fff;cursor:pointer;font-weight:600}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text)}
  .left-col{display:flex;flex-direction:column;gap:12px;flex:1}
  .board-wrap{display:flex;gap:20px;margin-top:14px;align-items:flex-start}
  .board{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); padding:14px;border-radius:12px;min-width:320px;box-shadow:0 8px 30px rgba(0,0,0,0.6)}
  .grid{display:grid;gap:var(--gap);width:100%;transition:all .32s ease}
  .cell{background:var(--cell);color:var(--cell-text);display:flex;align-items:center;justify-content:center;text-align:center;padding:10px;border-radius:var(--radius);cursor:pointer;user-select:none;box-shadow:0 4px 12px rgba(0,0,0,0.45);border:1px solid var(--cell-border);min-height:var(--cell-size);min-width:var(--cell-size);transition:transform .12s cubic-bezier(.2,.9,.2,1), box-shadow .12s}
  .cell:hover{transform:translateY(-4px)}
  .cell.marked{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.08));outline:3px solid rgba(255,255,255,0.02);text-decoration:line-through;color:var(--marked-text);border-color:var(--marked-border)}
  .cell .inner{width:100%}
  .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .sidebar{min-width:260px;max-width:320px;display:flex;flex-direction:column;gap:12px}
  .theme-picker{display:flex;gap:8px;flex-wrap:wrap}
  .theme-btn{padding:8px 12px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);cursor:pointer}
  label.small{font-size:12px;opacity:0.85}
  textarea.phrases{min-height:120px;resize:vertical}
  .badge{position:fixed;left:18px;bottom:18px;padding:10px 14px;border-radius:12px;background:var(--accent);color:#fff;box-shadow:0 8px 30px rgba(0,0,0,.6);display:none;z-index:9999}
  .toast{position:fixed;right:18px;bottom:18px;padding:10px 14px;border-radius:10px;background:rgba(0,0,0,0.6);color:#fff;display:none;z-index:9999}
  .muted{opacity:.8;font-size:13px}
  .row{display:flex;gap:8px;align-items:center}
  .title-small{font-size:13px;color:var(--text);opacity:.9;margin:0}
  .header-right{display:flex;gap:8px;align-items:center}
  .hint{font-size:12px;color:rgba(255,255,255,0.6)}

  /* confetti canvas */
  #confetti-canvas{position:fixed;left:0;top:0;pointer-events:none;z-index:9998}

  /* Themes (overrides) */
  .theme-cyberpunk{ --bg:#070717; --bg2:#0e0820; --text:#f5c8ff; --accent:#ff2d95; --accent2:#8cffd6; --cell:#1a042b; --cell-text:#ffd6f0; --cell-border:#2b003b; --marked:#2b003b; --marked-text:#ffd6f0 }
  .theme-nordic{ --bg:#07121a; --bg2:#0f2936; --text:#dff3ff; --accent:#7ec0ff; --accent2:#aee6ff; --cell:#082a3c; --cell-text:#dff3ff; --cell-border:#063b53; --marked:#06202a; --marked-text:#bfe7ff }
  .theme-pixel{ --bg:#0b0b0b; --bg2:#141414; --text:#ffd166; --accent:#ffd166; --accent2:#ff725c; --cell:#1c1c1c; --cell-text:#ffd166; --cell-border:#2f2f2f; --marked:#111111; --marked-text:#ffd166; --radius:4px }
  .theme-bloodbornerich{ --bg:#0a0606; --bg2:#1a0d0d; --text:#f4dede; --accent:#b10b0b; --accent2:#ff7f7f; --cell:#5e1515; --cell-text:#ffeaea; --cell-border:#300606; --marked:#2a0000; --marked-text:#ffb5b5 }

  /* small screens */
  @media(max-width:900px){
    .board-wrap{flex-direction:column}
    .sidebar{width:100%}
    .grid{width:100%}
  }
</style>
</head>
<body class="theme-bloodbornerich">

<div class="app">
  <header>
    <div>
      <h1>NeuroBingo</h1>
      <div class="muted">Game Awards edition — divirta-se com seus amigos!</div>
    </div>

    <div class="header-right">
      <div class="muted">Modo: <span id="modeLabel">Jogo</span></div>
      <div class="controls">
        <label class="small">Tamanho</label>
        <select id="grid-size" title="Escolha o tamanho do grid">
          <option value="3">3</option><option value="4">4</option><option value="5" selected>5</option>
          <option value="6">6</option><option value="7">7</option><option value="8">8</option>
        </select>

        <button id="btn-generate" class="ghost" title="Gerar cartela aleatória">Gerar aleatório</button>
        <button id="btn-shuffle" class="ghost" title="Embaralhar frases">Embaralhar</button>
        <button id="btn-download" class="ghost" title="Baixar PNG">Baixar PNG</button>
        <button id="btn-share" class="ghost" title="Gerar link compartilhável">Compartilhar</button>
      </div>
    </div>
  </header>

  <div class="board-wrap">
    <div class="left-col">
      <div class="board">
        <div class="toolbar" style="justify-content:space-between;margin-bottom:8px">
          <div class="row">
            <button id="edit-toggle" title="Alternar modo edição">✎ Editar</button>
            <button id="clear-grid" class="ghost">Limpar</button>
            <button id="save-btn" class="ghost">Salvar local</button>
          </div>
          <div class="row">
            <div class="hint">Duplo clique em uma célula para editar direto.</div>
          </div>
        </div>

        <div id="grid" class="grid" aria-label="Bingo grid"></div>
      </div>

      <div style="display:flex;gap:12px;margin-top:10px;align-items:center">
        <div class="muted">Conjunto de frases:</div>
        <button id="preset-gawa" class="ghost">Carregar GameAwards</button>
        <button id="preset-chaos" class="ghost">Chaos Mode</button>
      </div>
    </div>

    <aside class="sidebar">
      <div>
        <p class="title-small">Temas</p>
        <div class="theme-picker">
          <button class="theme-btn" data-theme="">Padrão</button>
          <button class="theme-btn" data-theme="theme-bloodbornerich">Bloodborne</button>
          <button class="theme-btn" data-theme="theme-cyberpunk">Cyberpunk</button>
          <button class="theme-btn" data-theme="theme-nordic">Nórdico</button>
          <button class="theme-btn" data-theme="theme-pixel">Pixel</button>
        </div>
      </div>

      <div>
        <p class="title-small">Frases (uma por linha)</p>
        <textarea id="phrases" class="phrases" placeholder="Cole frases — clique em 'Aplicar' para preencher o grid"></textarea>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="apply-phrases">Aplicar</button>
          <button id="fill-random" class="ghost">Preencher aleatório</button>
        </div>
      </div>

      <div>
        <p class="title-small">Salvamento automático</p>
        <div class="muted">Seu progresso é salvo no navegador automaticamente.</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="export-json" class="ghost">Exportar JSON</button>
          <button id="import-json" class="ghost">Importar JSON</button>
        </div>
        <input type="file" id="fileImport" style="display:none" accept=".json" />
      </div>

      <div>
        <p class="title-small">Extras</p>
        <div style="display:flex;gap:8px;flex-direction:column">
          <button id="btn-confetti" class="ghost">Testar Confete</button>
          <div class="muted">Sons: ativados por padrão — você pode pausar no painel de som (inferior)</div>
        </div>
      </div>

    </aside>
  </div>
</div>

<div id="badge" class="badge">BINGO!</div>
<div id="toast" class="toast"></div>
<canvas id="confetti-canvas"></canvas>

<!-- html2canvas CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
/* ------------- Estado ------------- */
const state = {
  size: 5,
  editing: false,
  cells: [], // textos
  marks: [], // boolean
  theme: '',
  phrasesPool: [],
  achievements: new Set(),
  soundsOn: true,
}

/* ---- DOM ---- */
const gridEl = document.getElementById('grid')
const sizeSelect = document.getElementById('grid-size')
const editToggle = document.getElementById('edit-toggle')
const btnShuffle = document.getElementById('btn-shuffle')
const btnGenerate = document.getElementById('btn-generate')
const btnDownload = document.getElementById('btn-download')
const btnShare = document.getElementById('btn-share')
const applyPhrasesBtn = document.getElementById('apply-phrases')
const phrasesTextarea = document.getElementById('phrases')
const fillRandomBtn = document.getElementById('fill-random')
const themeBtns = document.querySelectorAll('.theme-btn')
const badge = document.getElementById('badge')
const toast = document.getElementById('toast')
const presetGA = document.getElementById('preset-gawa')
const presetChaos = document.getElementById('preset-chaos')
const saveBtn = document.getElementById('save-btn')
const clearBtn = document.getElementById('clear-grid')
const exportBtn = document.getElementById('export-json')
const importBtn = document.getElementById('import-json')
const fileImportInput = document.getElementById('fileImport')
const confettiBtn = document.getElementById('btn-confetti')
const modeLabel = document.getElementById('modeLabel')

/* ---- util: toast & badge ---- */
function showToast(msg, ms=1600){
  toast.innerText = msg; toast.style.display='block'; setTimeout(()=>toast.style.display='none', ms)
}
function unlock(name){
  if(!state.achievements.has(name)){
    state.achievements.add(name)
    badge.innerText = name; badge.style.display='block'
    setTimeout(()=>badge.style.display='none', 1800)
  }
}

/* ---- THEME ---- */
function applyTheme(cls){
  document.body.className = cls || ''
  state.theme = cls || ''
  localSave()
  playThemeSound()
}
themeBtns.forEach(b => b.addEventListener('click', ()=> applyTheme(b.dataset.theme)))

/* ---- GRID BUILD/RENDER ---- */
function buildGrid(size = state.size){
  state.size = size
  const amount = size * size
  // ensure arrays
  if(!state.cells || state.cells.length !== amount) state.cells = Array(amount).fill('')
  if(!state.marks || state.marks.length !== amount) state.marks = Array(amount).fill(false)

  gridEl.innerHTML = ''
  gridEl.style.gridTemplateColumns = `repeat(${size}, 1fr)`
  for(let i=0;i<amount;i++){
    const cell = document.createElement('div')
    cell.className = 'cell'
    if(state.marks[i]) cell.classList.add('marked')

    const inner = document.createElement('div'); inner.className='inner'
    inner.innerText = state.cells[i] || ''
    cell.appendChild(inner)
    cell.dataset.index = i

    // click & dblclick
    cell.addEventListener('click', (e)=>{
      if(state.editing){
        editCell(i, cell)
      } else {
        toggleMark(i, cell)
      }
    })
    cell.addEventListener('dblclick', (e)=>{
      editCell(i, cell)
    })

    gridEl.appendChild(cell)
  }
  localSave()
}

function renderCells(){
  const amount = state.size * state.size
  const nodes = gridEl.querySelectorAll('.cell')
  for(let i=0;i<amount;i++){
    const n = nodes[i]
    if(!n) continue
    const inner = n.querySelector('.inner')
    inner.innerText = state.cells[i] || ''
    n.classList.toggle('marked', !!state.marks[i])
  }
}

/* ---- Edit / Toggle ---- */
function toggleEdit(){
  state.editing = !state.editing
  modeLabel.innerText = state.editing ? 'Edição' : 'Jogo'
  editToggle.innerText = state.editing ? '✓ Salvando' : '✎ Editar'
  editToggle.style.opacity = state.editing ? '1' : '0.85'
}
editToggle.addEventListener('click', ()=>{ toggleEdit(); localSave() })

function editCell(i, cellEl){
  // prompt is simple; inline input UX
  const prev = state.cells[i] || ''
  const val = prompt('Edite a célula:', prev)
  if(val === null) return
  state.cells[i] = val
  state.marks[i] = false
  renderCells()
  localSave()
}

/* ---- Marking ---- */
function toggleMark(i, cellEl){
  state.marks[i] = !state.marks[i]
  renderCells()
  playClickSound()
  if(checkLineComplete()) {
    // celebration
    unlock('BINGO!')
    showConfetti()
    playBingoSound()
  }
  localSave()
}

/* ---- Random Fill / Shuffle ---- */
function randomFillFromPool(){
  const pool = state.phrasesPool.length ? state.phrasesPool.slice() : []
  const total = state.size * state.size
  // if pool smaller than needed, duplicate pool
  while(pool.length < total){
    pool.push(...state.phrasesPool)
    if(pool.length === 0) break
  }
  // shuffle and take
  for(let i=0;i<total;i++){
    if(pool.length === 0){ state.cells[i] = ''; continue }
    const j = Math.floor(Math.random() * pool.length)
    state.cells[i] = pool.splice(j,1)[0]
    state.marks[i] = false
  }
  renderCells()
  localSave()
}

function shuffleCells(){
  const arr = state.cells.slice()
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1))
    [arr[i],arr[j]] = [arr[j],arr[i]]
  }
  state.cells = arr
  state.marks = Array(state.size*state.size).fill(false)
  renderCells()
  showToast('Embaralhado')
  unlock('Shuffle Master')
  localSave()
}

/* ---- Check line/col/diag complete ---- */
function checkLineComplete(){
  const n = state.size
  const m = state.marks
  // rows
  for(let r=0;r<n;r++){
    let ok = true
    for(let c=0;c<n;c++) if(!m[r*n+c]){ ok=false; break }
    if(ok) return true
  }
  // cols
  for(let c=0;c<n;c++){
    let ok = true
    for(let r=0;r<n;r++) if(!m[r*n+c]){ ok=false; break }
    if(ok) return true
  }
  // diag
  let ok = true
  for(let i=0;i<n;i++) if(!m[i*n+i]) ok=false
  if(ok) return true
  ok = true
  for(let i=0;i<n;i++) if(!m[i*n+(n-1-i)]) ok=false
  if(ok) return true
  return false
}

/* ---- Share (serialize in URL) ---- */
function makeShareURL(){
  const data = {size: state.size, cells: state.cells}
  const s = btoa(unescape(encodeURIComponent(JSON.stringify(data))))
  const u = location.origin + location.pathname + '?b=' + encodeURIComponent(s)
  navigator.clipboard.writeText(u).then(()=> showToast('Link copiado para a área de transferência!'))
}

/* ---- Load from URL ---- */
function loadFromURL(){
  const p = new URLSearchParams(location.search)
  if(!p.has('b')) return
  try{
    const decoded = decodeURIComponent(p.get('b'))
    const obj = JSON.parse(decodeURIComponent(escape(atob(decoded))))
    if(obj && obj.size && Array.isArray(obj.cells)){
      state.size = obj.size
      state.cells = obj.cells
      state.marks = Array(state.size*state.size).fill(false)
      sizeSelect.value = state.size
      buildGrid(state.size)
      renderCells()
      showToast('Cartela carregada do link')
    }
  }catch(e){ console.warn('loadFromURL failed', e) }
}

/* ---- Export / Import JSON ---- */
function exportJSON(){
  const data = {size: state.size, cells: state.cells, marks: state.marks, theme: state.theme}
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'})
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'neurobingo.json'; a.click()
}
function importJSONFile(file){
  const reader = new FileReader()
  reader.onload = () => {
    try{
      const obj = JSON.parse(reader.result)
      if(obj.size && Array.isArray(obj.cells)){
        state.size = obj.size; state.cells = obj.cells; state.marks = obj.marks || Array(state.size*state.size).fill(false)
        sizeSelect.value = state.size
        buildGrid(state.size); renderCells(); localSave()
        showToast('Arquivo importado')
      }
    }catch(e){ showToast('Arquivo inválido') }
  }
  reader.readAsText(file)
}

/* ---- Save to localStorage ---- */
function localSave(){
  try{
    const data = {size:state.size, cells:state.cells, marks:state.marks, theme:state.theme}
    localStorage.setItem('neurobingo_v1', JSON.stringify(data))
  }catch(e){ console.warn('localSave fail', e) }
}
function localLoad(){
  try{
    const raw = localStorage.getItem('neurobingo_v1')
    if(!raw) return
    const obj = JSON.parse(raw)
    if(obj.size && Array.isArray(obj.cells)){
      state.size = obj.size; state.cells = obj.cells; state.marks = obj.marks || Array(state.size*state.size).fill(false)
      state.theme = obj.theme || ''
      sizeSelect.value = state.size
      buildGrid(state.size)
      applyTheme(state.theme)
      renderCells()
      showToast('Progresso restaurado do navegador')
    }
  }catch(e){ console.warn('localLoad', e) }
}

/* ---- Export PNG (html2canvas) ---- */
async function downloadPNG(){
  showToast('Gerando imagem...')
  // small styling hack: temporarily remove focus
  const prev = document.activeElement
  try{
    const canvas = await html2canvas(gridEl, {backgroundColor: null, scale:2})
    const a = document.createElement('a')
    a.href = canvas.toDataURL('image/png')
    a.download = 'neurobingo.png'
    a.click()
    showToast('Imagem pronta')
  }catch(e){ showToast('Erro ao gerar imagem') }
  if(prev) prev.focus()
}

/* ---- Sounds (WebAudio) ---- */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)()
function playTone(freq, dur=0.06, type='sine'){
  if(!state.soundsOn) return
  const o = audioCtx.createOscillator(); const g = audioCtx.createGain()
  o.type = type; o.frequency.value = freq
  o.connect(g); g.connect(audioCtx.destination); g.gain.value = 0.06
  o.start(); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur)
  setTimeout(()=>{o.stop()}, dur*1000 + 20)
}
function playClickSound(){ playTone(720, 0.06, 'sine') }
function playBingoSound(){ playTone(520, 0.25, 'square'); setTimeout(()=>playTone(820,0.15,'sine'), 180) }
function playThemeSound(){
  // subtle short melody per theme
  if(!state.soundsOn) return
  if(state.theme === 'theme-cyberpunk'){ playTone(880,0.06,'sawtooth'); setTimeout(()=>playTone(660,0.06,'sine'),90) }
  else if(state.theme === 'theme-nordic'){ playTone(420,0.1,'triangle'); setTimeout(()=>playTone(520,0.08,'sine'),120) }
  else if(state.theme === 'theme-pixel'){ playTone(1100,0.03,'square'); setTimeout(()=>playTone(900,0.03,'square'),60) }
  else { playTone(540,0.06,'sine') }
}

/* ---- Confetti (simple particles) ---- */
const confettiCanvas = document.getElementById('confetti-canvas')
const confettiCtx = confettiCanvas.getContext('2d')
let confettiPieces = []
function resizeConfetti(){ confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight }
window.addEventListener('resize', resizeConfetti); resizeConfetti()

function emitConfetti(count=80){
  confettiPieces = []
  for(let i=0;i<count;i++){
    confettiPieces.push({
      x: Math.random()*confettiCanvas.width,
      y: -20 - Math.random()*200,
      vx: (Math.random()-0.5)*6,
      vy: 2 + Math.random()*6,
      size: 6 + Math.random()*8,
      color: `hsl(${Math.random()*360}deg 80% 60%)`,
      rot: Math.random()*360,
      rotSpeed: (Math.random()-0.5)*10
    })
  }
  if(!confettiLoopRunning) requestAnimationFrame(confettiLoop)
}
let confettiLoopRunning = false
function confettiLoop(){
  confettiLoopRunning = true
  confettiCtx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height)
  for(let p of confettiPieces){
    p.x += p.vx; p.y += p.vy; p.vy += 0.12; p.rot += p.rotSpeed
    confettiCtx.save()
    confettiCtx.translate(p.x, p.y); confettiCtx.rotate(p.rot*Math.PI/180)
    confettiCtx.fillStyle = p.color
    confettiCtx.fillRect(-p.size/2, -p.size/2, p.size, p.size*0.6)
    confettiCtx.restore()
  }
  confettiPieces = confettiPieces.filter(p => p.y < confettiCanvas.height + 50)
  if(confettiPieces.length>0) requestAnimationFrame(confettiLoop)
  else confettiLoopRunning = false
}
function showConfetti(){ emitConfetti(100); unlock('Party!') }

/* ---- Presets: Game Awards / Chaos Mode ---- */
const presetGameAwards = [
  "Trailer com gameplay",
  "Anúncio surpresa",
  "Indie ganha prêmio principal",
  "Multiplayer anunciado",
  "Port para Switch anunciado",
  "Remake/Remaster anunciado",
  "Hideo Kojima mencionado",
  "Apresentador faz piada sobre prêmio",
  "Novo IP anunciado",
  "Live reaction famosa",
  "Corte de música ao vivo",
  "Gameplay com porte de AAA",
  "Clássico retornando",
  "DLC anunciada",
  "Developer trabalhando no palco",
  "Erro técnico ao vivo",
  "Cosplayer no público",
  "Parceria inesperada anunciada",
  "Trailer com ritmo acelerado",
  "3rd party exclusive announced"
]
const presetChaos = [
  "Todd Howard aparece fantasma",
  "Plataforma misteriosa surge",
  "Trailer em VHS",
  "Foo Fighters tocam metal",
  "Leiteiro do público ganha prêmio",
  "Anúncio de jogo de 1999",
  "Geoff Keighley joga em modo chefe",
  "Cena cortada vira meme",
  "Jogo indie com visual amarelo",
  "A tecnologia do futuro aparece",
  "Ritual místico em trailer"
]

/* ---- Event wiring ---- */
sizeSelect.addEventListener('change', ()=>{
  const s = parseInt(sizeSelect.value)
  buildGrid(s)
  localSave()
})
btnShuffle.addEventListener('click', ()=> shuffleCells())
btnGenerate.addEventListener('click', ()=> {
  if(state.phrasesPool.length === 0){
    showToast('Cole frases no campo à direita ou carregue um preset.')
    return
  }
  randomFillFromPool()
  showToast('Cartela preenchida aleatoriamente')
})
applyPhrasesBtn.addEventListener('click', ()=>{
  const raw = phrasesTextarea.value.trim()
  state.phrasesPool = raw.split('\n').map(s=>s.trim()).filter(Boolean)
  showToast(state.phrasesPool.length + ' frases carregadas')
  localSave()
})
fillRandomBtn.addEventListener('click', ()=> { // quick fill from textarea or preset
  if(state.phrasesPool.length===0){ showToast('Nenhuma frase carregada'); return }
  randomFillFromPool()
})
btnDownload.addEventListener('click', downloadPNG)
btnShare.addEventListener('click', makeShareURL)
presetGA.addEventListener('click', ()=> { phrasesTextarea.value = presetGameAwards.join('\\n'); applyPhrasesBtn.click(); showToast('Game Awards carregado') })
presetChaos.addEventListener('click', ()=> { phrasesTextarea.value = presetChaos.join('\\n'); applyPhrasesBtn.click(); showToast('Chaos Mode carregado') })
saveBtn.addEventListener('click', ()=> { localSave(); showToast('Salvo localmente') })
clearBtn.addEventListener('click', ()=> { if(confirm('Limpar a cartela?')){ state.cells = Array(state.size*state.size).fill(''); state.marks = Array(state.size*state.size).fill(false); renderCells(); localSave() } })
btnConfetti.addEventListener('click', ()=> { showConfetti() })

exportBtn.addEventListener('click', exportJSON)
importBtn.addEventListener('click', ()=> fileImportInput.click())
fileImportInput.addEventListener('change', (e)=> importJSONFile(e.target.files[0]))

/* ---- Share load on start ---- */
loadFromURL()

/* ---- Initial quick load or fresh build ---- */
if(!state.cells || state.cells.length === 0){
  buildGrid(state.size)
} else {
  buildGrid(state.size)
  renderCells()
}
localLoad()

/* ---- Clipboard paste: allow paste of prebuilt cartela (one-line JSON) ---- */
window.addEventListener('paste', (e)=>{
  try{
    const t = e.clipboardData.getData('text')
    if(t && t.startsWith('{') && t.includes('cells')){
      // try parse and load
      const obj = JSON.parse(t)
      if(obj.size && Array.isArray(obj.cells)){
        state.size = obj.size; state.cells = obj.cells; state.marks = obj.marks || Array(state.size*state.size).fill(false)
        sizeSelect.value = state.size; buildGrid(state.size); renderCells(); showToast('Cartela carregada do clipboard')
      }
    }
  }catch(err){/* ignore */ }
})

/* ---- Keyboard: space to toggle last focused cell (accessibility) ---- */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape' && state.editing){ state.editing = false; toggleEdit() }
})

/* ---- Load from URL on page ready (if present) ---- */
window.addEventListener('load', ()=>{
  // quick patch: if there's saved local but URL param present, prioritize URL
  if(new URLSearchParams(location.search).has('b')) loadFromURL()
})

/* ---- End of Script ---- */
</script>
</body>
</html>
